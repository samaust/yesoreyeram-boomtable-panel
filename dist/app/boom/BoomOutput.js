System.register(["lodash", "./BoomUtils"], function (exports_1, context_1) {
    "use strict";
    var lodash_1, BoomUtils_1, BoomOutput;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (BoomUtils_1_1) {
                BoomUtils_1 = BoomUtils_1_1;
            }
        ],
        execute: function () {
            BoomOutput = /** @class */ (function () {
                function BoomOutput(options) {
                    this.default_title_for_rows = options.default_title_for_rows || '';
                    this.hide_first_column = options.hide_first_column;
                    this.hide_headers = options.hide_headers;
                    this.text_alignment_firstcolumn = options.text_alignment_firstcolumn || '';
                    this.text_alignment_values = options.text_alignment_values || '';
                    this.first_column_link = options.first_column_link || '#';
                }
                return BoomOutput;
            }());
            exports_1("BoomOutput", BoomOutput);
            BoomOutput.prototype.getDataAsHTML = function (data, sorting_props) {
                var _this = this;
                var getLinkifiedColumn = function (rowName, first_column_link, raw_rowName) {
                    if (first_column_link !== '#') {
                        first_column_link = first_column_link.replace(new RegExp('_row_name_', 'g'), BoomUtils_1.getActualNameWithoutTokens(raw_rowName).trim());
                        rowName = "<a href=\"" + first_column_link + "\" target=\"_blank\">" + rowName + "</a>";
                    }
                    return rowName;
                };
                var output = {
                    body: '',
                };
                if (sorting_props &&
                    sorting_props.col_index !== undefined &&
                    sorting_props.col_index > -1 &&
                    data &&
                    data.output &&
                    data.output.length >= sorting_props.col_index) {
                    var sortFunction_1 = function (a, b, sortMethod) {
                        if (sortMethod === 'asc') {
                            return a[sorting_props.col_index].value - b[sorting_props.col_index].value;
                        }
                        else {
                            return b[sorting_props.col_index].value - a[sorting_props.col_index].value;
                        }
                    };
                    data.output = data.output
                        .filter(function (a) { return !isNaN(a[sorting_props.col_index].value); })
                        .concat(data.output.filter(function (a) { return isNaN(a[sorting_props.col_index].value); }))
                        .sort(function (a, b) { return sortFunction_1(a, b, sorting_props.direction); });
                }
                lodash_1.default.each(data.output, function (o) {
                    var not_hidden = o.map(function (item) { return item.hidden.toString(); }).indexOf('false') > -1;
                    if (not_hidden) {
                        output.body += '<tr>';
                        if (_this.hide_first_column !== true) {
                            var raw_rowName = lodash_1.default.first(o.map(function (item) { return item.row_name_raw; }));
                            output.body += "\n                    <td style=\"padding:4px;text-align:" + _this.text_alignment_firstcolumn + "\">\n                        " + getLinkifiedColumn(lodash_1.default.first(o.map(function (item) { return item.row_name; })), String(_this.first_column_link), raw_rowName) + "\n                    </td>";
                        }
                        lodash_1.default.each(o, function (item) {
                            var item_style = "padding:4px;background-color:" + item.color_bg + ";color:" + item.color_text + ";text-align:" + _this.text_alignment_values;
                            var item_display = item.link === '#'
                                ? item.display_value
                                : "<a href=\"" + item.link + "\" target=\"_blank\" style=\"color:" + item.color_text + "\">" + item.display_value + "</a>";
                            var tooltip = !item.tooltip || item.tooltip === '-'
                                ? undefined
                                : " data-toggle=\"tooltip\" data-html=\"true\" data-placement=\"auto\" title=\"" + item.tooltip + "\" ";
                            output.body += "\n                    <td style=\"" + item_style + "\">\n                        " + (tooltip ? "<span " + tooltip + ">" : '') + "\n                            " + item_display + "\n                        " + (tooltip ? "</span>" : '') + "\n                    </td>\n                ";
                        });
                        output.body += '</tr>';
                    }
                });
                return output;
            };
            BoomOutput.prototype.getDataAsDebugHTML = function (data) {
                var debugdata = "";
                debugdata = lodash_1.default.map(data, function (d) {
                    return "\n        <tr>\n            <td style=\"padding:4px;text-align:left;width:30%; title=\"Series Name\" >" + d.seriesName + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Matching Pattern Name\" >" + (d.pattern.name || d.pattern.pattern || 'Default') + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Value : " + String(d.value_formatted || 'null') + " / Raw : " + String(d.value || 'null') + " / Stat : " + d.pattern.valueName + "\">" + d.display_value + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Row name\" >" + d.row_name + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Col name\" >" + d.col_name + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Thresholds\" >" + d.thresholds.join(d.separator) + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"BG Color\" >" + d.color_bg + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Text Color\" >" + d.color_text + "</td>\n        </tr>\n        ";
                }).join("");
                return debugdata;
            };
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQm9vbU91dHB1dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcHAvYm9vbS9Cb29tT3V0cHV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O1lBSUE7Z0JBU0Usb0JBQVksT0FBOEI7b0JBQ3hDLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxPQUFPLENBQUMsc0JBQXNCLElBQUksRUFBRSxDQUFDO29CQUNuRSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDO29CQUNuRCxJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUM7b0JBQ3pDLElBQUksQ0FBQywwQkFBMEIsR0FBRyxPQUFPLENBQUMsMEJBQTBCLElBQUksRUFBRSxDQUFDO29CQUMzRSxJQUFJLENBQUMscUJBQXFCLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixJQUFJLEVBQUUsQ0FBQztvQkFDakUsSUFBSSxDQUFDLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsSUFBSSxHQUFHLENBQUM7Z0JBQzVELENBQUM7Z0JBQ0gsaUJBQUM7WUFBRCxDQUFDLEFBakJELElBaUJDOztZQUNELFVBQVUsQ0FBQyxTQUFTLENBQUMsYUFBYSxHQUFHLFVBQVMsSUFBZ0IsRUFBRSxhQUFhO2dCQUF4QyxpQkFnRXBDO2dCQS9EQyxJQUFJLGtCQUFrQixHQUFHLFVBQVMsT0FBZSxFQUFFLGlCQUF5QixFQUFFLFdBQW1CO29CQUMvRixJQUFJLGlCQUFpQixLQUFLLEdBQUcsRUFBRTt3QkFDN0IsaUJBQWlCLEdBQUcsaUJBQWlCLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsRUFBRSxzQ0FBMEIsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO3dCQUM3SCxPQUFPLEdBQUcsZUFBWSxpQkFBaUIsNkJBQXFCLE9BQU8sU0FBTSxDQUFDO3FCQUMzRTtv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QyxlQUFlLElBQUksTUFBTSxDQUFDLGlCQUFZLE1BQU0sQ0FDOUgsQ0FBQyxDQUFDLEtBQUssSUFBSSxNQUFNLENBQ2xCLGtCQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxXQUFLLENBQUMsQ0FBQyxhQUFhLGtHQUN5QixDQUFDLENBQUMsUUFBUSxrR0FDVixDQUFDLENBQUMsUUFBUSxvR0FDUixDQUFDLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLGtHQUNoQyxDQUFDLENBQUMsUUFBUSxvR0FDUixDQUFDLENBQUMsVUFBVSxtQ0FFdkYsQ0FBQztnQkFDUixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ1osT0FBTyxTQUFTLENBQUM7WUFDbkIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcclxuaW1wb3J0IHsgSUJvb21IVE1MLCBJQm9vbVRhYmxlLCBJQm9vbVJlbmRlcmluZ09wdGlvbnMsIElCb29tU2VyaWVzIH0gZnJvbSAnLi9pbmRleCc7XHJcbmltcG9ydCB7IGdldEFjdHVhbE5hbWVXaXRob3V0VG9rZW5zIH0gZnJvbSAnLi9Cb29tVXRpbHMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIEJvb21PdXRwdXQge1xyXG4gIHB1YmxpYyBkZWZhdWx0X3RpdGxlX2Zvcl9yb3dzOiBTdHJpbmc7XHJcbiAgcHVibGljIGhpZGVfZmlyc3RfY29sdW1uOiBCb29sZWFuO1xyXG4gIHB1YmxpYyBoaWRlX2hlYWRlcnM6IEJvb2xlYW47XHJcbiAgcHVibGljIHRleHRfYWxpZ25tZW50X2ZpcnN0Y29sdW1uOiBTdHJpbmc7XHJcbiAgcHVibGljIHRleHRfYWxpZ25tZW50X3ZhbHVlczogU3RyaW5nO1xyXG4gIHB1YmxpYyBmaXJzdF9jb2x1bW5fbGluazogU3RyaW5nO1xyXG4gIHB1YmxpYyBnZXREYXRhQXNIVE1MO1xyXG4gIHB1YmxpYyBnZXREYXRhQXNEZWJ1Z0hUTUw7XHJcbiAgY29uc3RydWN0b3Iob3B0aW9uczogSUJvb21SZW5kZXJpbmdPcHRpb25zKSB7XHJcbiAgICB0aGlzLmRlZmF1bHRfdGl0bGVfZm9yX3Jvd3MgPSBvcHRpb25zLmRlZmF1bHRfdGl0bGVfZm9yX3Jvd3MgfHwgJyc7XHJcbiAgICB0aGlzLmhpZGVfZmlyc3RfY29sdW1uID0gb3B0aW9ucy5oaWRlX2ZpcnN0X2NvbHVtbjtcclxuICAgIHRoaXMuaGlkZV9oZWFkZXJzID0gb3B0aW9ucy5oaWRlX2hlYWRlcnM7XHJcbiAgICB0aGlzLnRleHRfYWxpZ25tZW50X2ZpcnN0Y29sdW1uID0gb3B0aW9ucy50ZXh0X2FsaWdubWVudF9maXJzdGNvbHVtbiB8fCAnJztcclxuICAgIHRoaXMudGV4dF9hbGlnbm1lbnRfdmFsdWVzID0gb3B0aW9ucy50ZXh0X2FsaWdubWVudF92YWx1ZXMgfHwgJyc7XHJcbiAgICB0aGlzLmZpcnN0X2NvbHVtbl9saW5rID0gb3B0aW9ucy5maXJzdF9jb2x1bW5fbGluayB8fCAnIyc7XHJcbiAgfVxyXG59XHJcbkJvb21PdXRwdXQucHJvdG90eXBlLmdldERhdGFBc0hUTUwgPSBmdW5jdGlvbihkYXRhOiBJQm9vbVRhYmxlLCBzb3J0aW5nX3Byb3BzKTogSUJvb21IVE1MIHtcclxuICBsZXQgZ2V0TGlua2lmaWVkQ29sdW1uID0gZnVuY3Rpb24ocm93TmFtZTogc3RyaW5nLCBmaXJzdF9jb2x1bW5fbGluazogc3RyaW5nLCByYXdfcm93TmFtZTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGlmIChmaXJzdF9jb2x1bW5fbGluayAhPT0gJyMnKSB7XHJcbiAgICAgIGZpcnN0X2NvbHVtbl9saW5rID0gZmlyc3RfY29sdW1uX2xpbmsucmVwbGFjZShuZXcgUmVnRXhwKCdfcm93X25hbWVfJywgJ2cnKSwgZ2V0QWN0dWFsTmFtZVdpdGhvdXRUb2tlbnMocmF3X3Jvd05hbWUpLnRyaW0oKSk7XHJcbiAgICAgIHJvd05hbWUgPSBgPGEgaHJlZj1cIiR7Zmlyc3RfY29sdW1uX2xpbmt9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+JHtyb3dOYW1lfTwvYT5gO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJvd05hbWU7XHJcbiAgfTtcclxuICBsZXQgb3V0cHV0OiBJQm9vbUhUTUwgPSB7XHJcbiAgICBib2R5OiAnJyxcclxuICB9O1xyXG4gIGlmIChcclxuICAgIHNvcnRpbmdfcHJvcHMgJiZcclxuICAgIHNvcnRpbmdfcHJvcHMuY29sX2luZGV4ICE9PSB1bmRlZmluZWQgJiZcclxuICAgIHNvcnRpbmdfcHJvcHMuY29sX2luZGV4ID4gLTEgJiZcclxuICAgIGRhdGEgJiZcclxuICAgIGRhdGEub3V0cHV0ICYmXHJcbiAgICBkYXRhLm91dHB1dC5sZW5ndGggPj0gc29ydGluZ19wcm9wcy5jb2xfaW5kZXhcclxuICApIHtcclxuICAgIGxldCBzb3J0RnVuY3Rpb24gPSAoYSwgYiwgc29ydE1ldGhvZCkgPT4ge1xyXG4gICAgICBpZiAoc29ydE1ldGhvZCA9PT0gJ2FzYycpIHtcclxuICAgICAgICByZXR1cm4gYVtzb3J0aW5nX3Byb3BzLmNvbF9pbmRleF0udmFsdWUgLSBiW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gYltzb3J0aW5nX3Byb3BzLmNvbF9pbmRleF0udmFsdWUgLSBhW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIGRhdGEub3V0cHV0ID0gZGF0YS5vdXRwdXRcclxuICAgICAgLmZpbHRlcihhID0+ICFpc05hTihhW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZSkpXHJcbiAgICAgIC5jb25jYXQoZGF0YS5vdXRwdXQuZmlsdGVyKGEgPT4gaXNOYU4oYVtzb3J0aW5nX3Byb3BzLmNvbF9pbmRleF0udmFsdWUpKSlcclxuICAgICAgLnNvcnQoKGEsIGIpID0+IHNvcnRGdW5jdGlvbihhLCBiLCBzb3J0aW5nX3Byb3BzLmRpcmVjdGlvbikpO1xyXG4gIH1cclxuICBfLmVhY2goZGF0YS5vdXRwdXQsIG8gPT4ge1xyXG4gICAgbGV0IG5vdF9oaWRkZW4gPSBvLm1hcChpdGVtID0+IGl0ZW0uaGlkZGVuLnRvU3RyaW5nKCkpLmluZGV4T2YoJ2ZhbHNlJykgPiAtMTtcclxuICAgIGlmIChub3RfaGlkZGVuKSB7XHJcbiAgICAgIG91dHB1dC5ib2R5ICs9ICc8dHI+JztcclxuICAgICAgaWYgKHRoaXMuaGlkZV9maXJzdF9jb2x1bW4gIT09IHRydWUpIHtcclxuICAgICAgICBsZXQgcmF3X3Jvd05hbWUgPSBfLmZpcnN0KG8ubWFwKGl0ZW0gPT4gaXRlbS5yb3dfbmFtZV9yYXcpKTtcclxuICAgICAgICBvdXRwdXQuYm9keSArPSBgXHJcbiAgICAgICAgICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjoke3RoaXMudGV4dF9hbGlnbm1lbnRfZmlyc3Rjb2x1bW59XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR7Z2V0TGlua2lmaWVkQ29sdW1uKF8uZmlyc3Qoby5tYXAoaXRlbSA9PiBpdGVtLnJvd19uYW1lKSksIFN0cmluZyh0aGlzLmZpcnN0X2NvbHVtbl9saW5rKSwgcmF3X3Jvd05hbWUpfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvdGQ+YDtcclxuICAgICAgfVxyXG4gICAgICBfLmVhY2gobywgaXRlbSA9PiB7XHJcbiAgICAgICAgbGV0IGl0ZW1fc3R5bGUgPSBgcGFkZGluZzo0cHg7YmFja2dyb3VuZC1jb2xvcjoke2l0ZW0uY29sb3JfYmd9O2NvbG9yOiR7aXRlbS5jb2xvcl90ZXh0fTt0ZXh0LWFsaWduOiR7dGhpcy50ZXh0X2FsaWdubWVudF92YWx1ZXN9YDtcclxuICAgICAgICBsZXQgaXRlbV9kaXNwbGF5ID1cclxuICAgICAgICAgIGl0ZW0ubGluayA9PT0gJyMnXHJcbiAgICAgICAgICAgID8gaXRlbS5kaXNwbGF5X3ZhbHVlXHJcbiAgICAgICAgICAgIDogYDxhIGhyZWY9XCIke2l0ZW0ubGlua31cIiB0YXJnZXQ9XCJfYmxhbmtcIiBzdHlsZT1cImNvbG9yOiR7aXRlbS5jb2xvcl90ZXh0fVwiPiR7aXRlbS5kaXNwbGF5X3ZhbHVlfTwvYT5gO1xyXG4gICAgICAgIGxldCB0b29sdGlwID1cclxuICAgICAgICAgICFpdGVtLnRvb2x0aXAgfHwgaXRlbS50b29sdGlwID09PSAnLSdcclxuICAgICAgICAgICAgPyB1bmRlZmluZWRcclxuICAgICAgICAgICAgOiBgIGRhdGEtdG9nZ2xlPVwidG9vbHRpcFwiIGRhdGEtaHRtbD1cInRydWVcIiBkYXRhLXBsYWNlbWVudD1cImF1dG9cIiB0aXRsZT1cIiR7aXRlbS50b29sdGlwfVwiIGA7XHJcbiAgICAgICAgb3V0cHV0LmJvZHkgKz0gYFxyXG4gICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT1cIiR7aXRlbV9zdHlsZX1cIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHt0b29sdGlwID8gYDxzcGFuICR7dG9vbHRpcH0+YCA6ICcnfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtpdGVtX2Rpc3BsYXl9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR7dG9vbHRpcCA/IGA8L3NwYW4+YCA6ICcnfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgICAgICAgICBgO1xyXG4gICAgICB9KTtcclxuICAgICAgb3V0cHV0LmJvZHkgKz0gJzwvdHI+JztcclxuICAgIH1cclxuICB9KTtcclxuICByZXR1cm4gb3V0cHV0O1xyXG59O1xyXG5Cb29tT3V0cHV0LnByb3RvdHlwZS5nZXREYXRhQXNEZWJ1Z0hUTUwgPSBmdW5jdGlvbihkYXRhOiBJQm9vbVNlcmllc1tdKTogc3RyaW5nIHtcclxuICBsZXQgZGVidWdkYXRhID0gYGA7XHJcbiAgZGVidWdkYXRhID0gXy5tYXAoZGF0YSwgZCA9PiB7XHJcbiAgICByZXR1cm4gYFxyXG4gICAgICAgIDx0cj5cclxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjMwJTsgdGl0bGU9XCJTZXJpZXMgTmFtZVwiID4ke2Quc2VyaWVzTmFtZX08L3RkPlxyXG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIk1hdGNoaW5nIFBhdHRlcm4gTmFtZVwiID4ke2QucGF0dGVybi5uYW1lIHx8IGQucGF0dGVybi5wYXR0ZXJuIHx8ICdEZWZhdWx0J308L3RkPlxyXG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIlZhbHVlIDogJHtTdHJpbmcoZC52YWx1ZV9mb3JtYXR0ZWQgfHwgJ251bGwnKX0gLyBSYXcgOiAke1N0cmluZyhcclxuICAgICAgZC52YWx1ZSB8fCAnbnVsbCdcclxuICAgICl9IC8gU3RhdCA6ICR7ZC5wYXR0ZXJuLnZhbHVlTmFtZX1cIj4ke2QuZGlzcGxheV92YWx1ZX08L3RkPlxyXG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIlJvdyBuYW1lXCIgPiR7ZC5yb3dfbmFtZX08L3RkPlxyXG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIkNvbCBuYW1lXCIgPiR7ZC5jb2xfbmFtZX08L3RkPlxyXG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIlRocmVzaG9sZHNcIiA+JHtkLnRocmVzaG9sZHMuam9pbihkLnNlcGFyYXRvcil9PC90ZD5cclxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJCRyBDb2xvclwiID4ke2QuY29sb3JfYmd9PC90ZD5cclxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJUZXh0IENvbG9yXCIgPiR7ZC5jb2xvcl90ZXh0fTwvdGQ+XHJcbiAgICAgICAgPC90cj5cclxuICAgICAgICBgO1xyXG4gIH0pLmpvaW4oYGApO1xyXG4gIHJldHVybiBkZWJ1Z2RhdGE7XHJcbn07XHJcbiJdfQ==